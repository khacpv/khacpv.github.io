(this["webpackJsonpstar-vision-game"]=this["webpackJsonpstar-vision-game"]||[]).push([[0],[,,,,,,,,function(e,t,n){e.exports=n(17)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(7),i=n.n(o),s=(n(13),n(14),n(1)),c=n(2),l=n(4),h=n(3),u=n(5),f=(n(15),function e(){Object(s.a)(this,e),this.reset=function(){this.setTopscore(),this.level=this.lines=this.score=0,this.gameOver=!1},this.setGameOver=function(){this.gameOver=!0},this.isGameOver=function(){return this.gameOver},this.setTopscore=function(){this.score>this.topscore&&(this.topscore=this.score)},this.getTopscore=function(){return this.topscore},this.getSpeed=function(){switch(this.level){case 0:return 700;case 1:return 600;case 2:return 500;case 3:return 400;case 4:return 350;case 5:return 300;case 6:return 250;case 7:return 200;case 8:return 150;case 9:default:return 100}},this.addScore=function(e){this.score+=e},this.addLines=function(e){switch(e){case 1:this.addScore(10);break;case 2:this.addScore(20);break;case 3:this.addScore(30);break;case 4:this.addScore(40);break;default:return}this.lines+=e,this.lines>10&&this.addLevel()},this.addLevel=function(){this.lines%=10,this.level<this.MAXLEVEL&&this.level++},this.getLevel=function(){return this.level},this.getLines=function(){return this.lines},this.getScore=function(){return this.score},this.MAXLEVEL=9,this.level=0,this.lines=0,this.score=0,this.topscore=0,this.gameOver=!0}),d={ZShape:[[0,-1],[0,0],[-1,0],[-1,1]],SShape:[[0,-1],[0,0],[1,0],[1,1]],IShape:[[0,-1],[0,0],[0,1],[0,2]],TShape:[[-1,0],[0,0],[1,0],[0,1]],Square:[[0,0],[1,0],[0,1],[1,1]],LShape:[[-1,-1],[0,-1],[0,0],[0,1]],JShape:[[1,-1],[0,-1],[0,0],[0,1]]},g=function e(t,n){var a=this;Object(s.a)(this,e),this.reset=function(){a.pos=new Array(4);for(var e=0;e<a.pos.length;e++)a.pos[e]=a.shape[e].slice();return a.pos},this.shape=t,this.pos=this.reset(),this.ordinal=n},p=(n(16),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onPressed,n=e.onReleased;return r.a.createElement("div",{className:"game-pad"},r.a.createElement("div",{className:"ctrl ctrl-up",onMouseUp:function(){n({key:"w"})},onMouseDown:function(){t({key:"w"})}},"ROTATE"),r.a.createElement("div",{className:"ctrl ctrl-left",onMouseUp:function(){n({key:"a"})},onMouseDown:function(){t({key:"a"})}},"LEFT"),r.a.createElement("div",{className:"ctrl ctrl-right",onMouseUp:function(){n({key:"d"})},onMouseDown:function(){t({key:"d"})}},"RIGHT"),r.a.createElement("div",{className:"ctrl ctrl-down",onMouseUp:function(){n({key:"s"})},onMouseDown:function(){t({key:"s"})}},"DOWN"))}}]),t}(r.a.Component)),v=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).onKeyUp=function(e){n.keyDown=!1,n.fastDown=!1},n.onKeyDown=function(e){if(!n.keyDown){if(n.keyDown=!0,n.scoreboard.isGameOver())return;switch(e.key){case"w":case"ArrowUp":n.canRotate(n.fallingShape)&&n.rotate(n.fallingShape);break;case"a":case"ArrowLeft":n.canMove(n.fallingShape,n.left)&&n.move(n.left);break;case"d":case"ArrowRight":n.canMove(n.fallingShape,n.right)&&n.move(n.right);break;case"s":case"ArrowDown":if(!n.fastDown){for(n.fastDown=!0;n.canMove(n.fallingShape,n.down);)n.move(n.down),n.draw();n.shapeHasLanded()}}n.draw()}},n.initCavas=function(){if(!n.canvas)throw new Error("Canvas not found");n.canvas.width=640,n.canvas.height=640,n.g=n.canvas.getContext("2d")},n.canRotate=function(e){if(e===d.Square)return!1;for(var t=new Array(4),a=0;a<t.length;a++)t[a]=e.pos[a].slice();return t.forEach((function(e){var t=e[0];e[0]=e[1],e[1]=-t})),t.every((function(e){var t=n.fallingShapeCol+e[0],a=n.fallingShapeRow+e[1];return-1===n.grid[a][t]}))},n.rotate=function(e){e!==d.Square&&e.pos.forEach((function(e){var t=e[0];e[0]=e[1],e[1]=-t}))},n.move=function(e){n.fallingShapeRow+=e.y,n.fallingShapeCol+=e.x},n.canMove=function(e,t){return e.pos.every((function(e){var a=n.fallingShapeCol+t.x+e[0],r=n.fallingShapeRow+t.y+e[1];return-1===n.grid[r][a]}))},n.shapeHasLanded=function(){n.addShape(n.fallingShape),n.fallingShapeRow<2?(n.scoreboard.setGameOver(),n.scoreboard.setTopscore()):n.scoreboard.addLines(n.removeLines()),n.selectShape()},n.removeLine=function(e){for(var t=0;t<n.nCols;t++)n.grid[e][t]=-1;for(var a=0;a<n.nCols;a++)for(var r=e;r>0;r--)n.grid[r][a]=n.grid[r-1][a]},n.addShape=function(e){e.pos.forEach((function(t){n.grid[n.fallingShapeRow+t[1]][n.fallingShapeCol+t[0]]=e.ordinal}))},n.getRandomShape=function(){var e=Object.keys(d),t=Math.floor(Math.random()*e.length),n=d[e[t]];return new g(n,t)},n.selectShape=function(){n.fallingShapeRow=1,n.fallingShapeCol=5,n.fallingShape=n.nextShape,n.nextShape=n.getRandomShape(),null!=n.fallingShape&&n.fallingShape.reset()},n.draw=function(){n.g.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawUI(),n.scoreboard.isGameOver()?n.drawStartScreen():n.drawFallingShape()},n.drawStartScreen=function(){n.g.font=n.mainFont,n.g.fillStyle=n.textColor,n.g.fillText("Tetris",n.titleX,n.titleY),n.g.font=n.smallFont,n.g.fillText("RESET to start",n.clickX,n.clickY)},n.fillRect=function(e,t){n.g.fillStyle=t,n.g.fillRect(e.x,e.y,e.w,e.h)},n.drawRect=function(e,t){n.g.strokeStyle=t,n.g.strokeRect(e.x,e.y,e.w,e.h)},n.drawSquare=function(e,t,a){var r=n.blockSize;n.g.fillStyle=n.colors[e],n.g.fillRect(n.leftMargin+a*r,n.topMargin+t*r,r,r),n.g.lineWidth=n.smallStroke,n.g.strokeStyle=n.squareBorder,n.g.strokeRect(n.leftMargin+a*r,n.topMargin+t*r,r,r)},n.drawUI=function(){n.fillRect(n.outerRect,n.bgColor),n.fillRect(n.gridRect,n.gridColor);for(var e=0;e<n.nRows;e++)for(var t=0;t<n.nCols;t++){var a=n.grid[e][t];a>-1&&n.drawSquare(a,e,t)}n.g.lineWidth=n.largeStroke,n.drawRect(n.gridRect,n.gridBorderColor),n.drawRect(n.previewRect,n.gridBorderColor),n.g.fillStyle=n.textColor,n.g.font=n.smallFont,n.g.fillText("hiscore    "+n.scoreboard.getTopscore(),n.scoreX,n.scoreY),n.g.fillText("level      "+n.scoreboard.getLevel(),n.scoreX,n.scoreY+30),n.g.fillText("lines      "+n.scoreboard.getLines(),n.scoreX,n.scoreY+60),n.g.fillText("score      "+n.scoreboard.getScore(),n.scoreX,n.scoreY+90);var r=5,o=5,i=0,s=0;n.nextShape.pos.forEach((function(e){r=Math.min(r,e[0]),o=Math.min(o,e[1]),i=Math.max(i,e[0]),s=Math.max(s,e[1])}));var c=n.previewCenterX-(r+i+1)/2*n.blockSize,l=n.previewCenterY-(o+s+1)/2*n.blockSize;n.g.translate(c,l),n.nextShape.shape.forEach((function(e){n.drawSquare(n.nextShape.ordinal,e[1],e[0])})),n.g.translate(-c,-l)},n.animate=function(e){var t=requestAnimationFrame((function(){n.animate(e)}));if(!n.state.pausing){var a=(new Date).getTime(),r=n.scoreboard.getSpeed();e+r<a&&(n.scoreboard.isGameOver()?cancelAnimationFrame(t):(n.canMove(n.fallingShape,n.down)?n.move(n.down):n.shapeHasLanded(),n.draw(),e=a))}},n.pauseGame=function(){n.setState({pausing:!0})},n.resumeGame=function(){n.setState({pausing:!1})},n.startNewGame=function(){n.setState({pausing:!1}),n.initGrid(),n.selectShape(),n.scoreboard.reset(),n.animate(-1)},n.initGrid=function(){for(var e=function(e,t){for(var n=0;n<e.length;n++)e[n]=t},t=0;t<n.nRows;t++){n.grid[t]=new Array(n.nCols),e(n.grid[t],-1);for(var a=0;a<n.nCols;a++)0!==a&&a!==n.nCols-1&&t!==n.nRows-1||(n.grid[t][a]=-2)}},n.canvas=null,n.g=null,n.right={x:1,y:0},n.down={x:0,y:1},n.left={x:-1,y:0},n.fallingShape=null,n.nextShape=null,n.dim=640,n.nRows=18,n.nCols=12,n.blockSize=30,n.topMargin=50,n.leftMargin=20,n.scoreX=400,n.scoreY=330,n.titleX=100,n.titleY=160,n.clickX=120,n.clickY=400,n.previewCenterX=467,n.previewCenterY=97,n.mainFont="bold 48px monospace",n.smallFont="bold 18px monospace",n.colors=["green","red","blue","purple","orange","blueviolet","magenta"],n.gridRect={x:46,y:47,w:308,h:517},n.previewRect={x:387,y:47,w:200,h:200},n.titleRect={x:85,y:95,w:252,h:100},n.clickRect={x:50,y:375,w:252,h:40},n.outerRect={x:5,y:5,w:630,h:630},n.squareBorder="white",n.titlebgColor="white",n.textColor="black",n.bgColor="#DDEEFF",n.gridColor="#BECFEA",n.gridBorderColor="#7788AA",n.largeStroke=5,n.smallStroke=2,n.fallingShapeRow=0,n.fallingShapeCol=0,n.keyDown=!1,n.fastDown=!1,n.grid=[],n.scoreboard=new f,n.state={pausing:!1},n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.initCavas(),this.initGrid(),this.selectShape(),this.draw(),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("keydown",this.onKeyDown)}},{key:"removeLines",value:function(){for(var e=0,t=0;t<this.nRows-1;t++)for(var n=1;n<this.nCols-1&&-1!==this.grid[t][n];n++)n===this.nCols-2&&(e++,this.removeLine(t));return e}},{key:"drawFallingShape",value:function(){var e=this,t=this.fallingShape.ordinal;this.fallingShape.pos.forEach((function(n){e.drawSquare(t,e.fallingShapeRow+n[1],e.fallingShapeCol+n[0])}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"game-manager"},r.a.createElement("div",{className:"game-container"},r.a.createElement("div",{className:"game-content"},r.a.createElement("canvas",{ref:function(t){e.canvas=t}}))),r.a.createElement("div",{className:"row"},r.a.createElement("button",{className:"btn btn-restart",onClick:this.startNewGame},"Reset"),!this.state.pausing&&r.a.createElement("button",{className:"btn btn-restart",onClick:this.pauseGame},"Pause"),this.state.pausing&&r.a.createElement("button",{className:"btn btn-restart",onClick:this.resumeGame},"Resume")),r.a.createElement(p,{onPressed:function(t){e.onKeyDown(t)},onReleased:function(t){e.onKeyUp(t)}}))}}]),t}(r.a.Component);var w=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(v,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[8,1,2]]]);
//# sourceMappingURL=main.78772211.chunk.js.map